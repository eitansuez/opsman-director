# Deploy Ops Manager and Bosh Director

## Description

## Assumptions

- Docker is installed
- Platform Automation Docker Image has been downloaded
  from the Pivotal Network and placed in a sibling directory named `artifacts`
- Ops Manager yaml for GCP has been downloaded
  from the Pivotal Network and placed in a sibling directory named `artifacts`
- GCP was paved (terraform)
- A file named `terraform-outputs.yml` was generated, and
  resides one directory above the path to this cloned repository,
  containing references to the resources generated by terraform
- direnv is installed and configured in your shell

## Steps

1. Import the platform automation docker image into docker

    ```bash
    docker import ../artifacts/platform-automation-image-*.tgz platform-automation-image
    ```

1. Run `p-automator` inside the docker image to create the Ops Manager VM

    ```bash
    docker run -it --rm -v $PWD../:/workspace -w /workspace/opsman-director platform-automation-image \
      p-automator create-vm \
        --config opsman-config.yml \
        --image-file ../artifacts/ops-manager*.yml \
        --vars-file ../terraform-outputs.yml
    ```

1. Once the VM is running, configure authentication to Ops Manager

    ```bash
    om --env env.yml configure-authentication \
      --username ${OM_USERNAME} \
      --password ${OM_PASSWORD} \
      --decryption-passphrase ${OM_DECRYPTION_PASSPHRASE}
    ```

1. Configure the BOSH director

    ```bash
    om --env env.yml configure-director \
      --config director-config.yml \
      --vars-file ../terraform-outputs.yml
    ```

1. Provision the bosh director

    ```bash
    om --env env.yml apply-changes \
      --skip-deploy-products
    ```
